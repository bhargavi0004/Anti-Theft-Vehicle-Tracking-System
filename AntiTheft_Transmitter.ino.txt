#include <TinyGPSPlus.h>
#include <SoftwareSerial.h>
#include <LiquidCrystal.h>

const int rs = 8, en = 9, d4 = 10, d5 = 11, d6 = 12, d7 = 13;
LiquidCrystal lcd(rs, en, d4, d5, d6, d7);
int sts=0;
float flat=0;
float flon=0;
TinyGPSPlus gps;
SoftwareSerial ss(2,3);
int sw=6;
int buz=7;
int cnt=0;
void read_gpsplus()
{ 
  for (unsigned long start = millis(); millis() - start < 1000;)
  {
  while (ss.available() > 0)
    if (gps.encode(ss.read()))
    {
       if (gps.location.isValid())
  {
  //  Serial.println(gps.location.lat(), 6);
   // Serial.println(gps.location.lng(), 6);
    flat=(gps.location.lat());
    flon=(gps.location.lng());
  }
    }
  
    }
}

void setup()
{
  Serial.begin(9600);
  ss.begin(9600);
 lcd.begin(16, 2);
  lcd.print("   WELCOME");
  delay(1000);
  pinMode(buz,OUTPUT);
  pinMode(sw,INPUT);
}

void loop()
{
 
  
    read_gpsplus();
    lcd.clear();
    lcd.print("L:"+String(flat)+","+String(flon));

    if(digitalRead(sw)==0)
    {
      sts=1-sts;
      digitalWrite(buz,1);
      
      delay(200);
      digitalWrite(buz,0);
    }

    if(sts==1)
    {
      lcd.setCursor(0,1);
      lcd.print("STARTED");
    }

    else
    {
      lcd.setCursor(0,1);
      lcd.print("STOPPED");
    }
ss.println("1");
    cnt=cnt+1;
if(cnt>15)
{

  
  cnt=0;
Serial.print("258299,DCEAA3CATXK0OE61,0,0,SRC 24G,src@internet,"+String(flat,6)+","+String(flon,6)+ ","+String(sts)+",0\n");
}
  delay(1000); 
  ss.println("1");   
}